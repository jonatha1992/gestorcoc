<div class="space-y-6 animate-in fade-in duration-500">
    <!-- Header Actions -->
    <div class="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
        <div>
            <h2 class="text-lg font-bold text-slate-800">Bitácora de Hechos</h2>
            <p class="text-slate-500 text-xs">Registro de eventos operativos y novedades policiales</p>
        </div>
        <button (click)="openForm()"
            class="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-xl text-xs font-bold transition-all shadow-md shadow-indigo-100 hover:scale-[1.02]">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Nuevo Registro
        </button>
    </div>

    <!-- Table View -->
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left text-xs text-slate-600">
                <thead class="bg-slate-50 border-b border-slate-100 text-[10px] uppercase font-bold text-slate-500">
                    <tr>
                        <th class="px-4 py-3">Orden</th>
                        <th class="px-4 py-3">Fecha/Hora</th>
                        <th class="px-4 py-3">Categoría</th>
                        <th class="px-4 py-3">Sector</th>
                        <th class="px-4 py-3">Descripción / Novedad</th>
                        <th class="px-4 py-3">Estado</th>
                        <th class="px-4 py-3 text-right">Acciones</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    @for (hecho of hechos(); track hecho.id) {
                    <tr class="hover:bg-slate-50/50 transition-colors">
                        <td class="px-4 py-3 font-medium text-slate-900">#{{ hecho.id }}</td>
                        <td class="px-4 py-3">
                            <div class="font-medium text-slate-900">{{ hecho.timestamp | date:'shortDate' }}</div>
                            <div class="text-[10px] text-slate-500">{{ hecho.timestamp | date:'shortTime' }}</div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-bold border"
                                [class.bg-blue-50]="hecho.category === 'POLICIAL'"
                                [class.text-blue-700]="hecho.category === 'POLICIAL'"
                                [class.border-blue-100]="hecho.category === 'POLICIAL'"
                                [class.bg-emerald-50]="hecho.category === 'OPERATIVO'"
                                [class.text-emerald-700]="hecho.category === 'OPERATIVO'"
                                [class.border-emerald-100]="hecho.category === 'OPERATIVO'"
                                [class.bg-slate-50]="hecho.category === 'INFORMATIVO'"
                                [class.text-slate-700]="hecho.category === 'INFORMATIVO'"
                                [class.border-slate-100]="hecho.category === 'INFORMATIVO'">
                                {{ hecho.category }}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-slate-500">{{ hecho.sector || '-' }}</td>
                        <td class="px-4 py-3 max-w-[200px] truncate" title="{{ hecho.description }}">
                            {{ hecho.description }}
                        </td>
                        <td class="px-4 py-3">
                            @if (hecho.is_solved) {
                            <span class="inline-flex items-center gap-1 text-emerald-600 font-medium text-[10px]">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 13l4 4L19 7"></path>
                                </svg>
                                Solucionado
                            </span>
                            } @else {
                            <span class="inline-flex items-center gap-1 text-amber-600 font-medium text-[10px]">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Pendiente
                            </span>
                            }
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div class="flex items-center justify-end gap-1">
                                <button (click)="editHecho(hecho)"
                                    class="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all"
                                    title="Editar">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                                <button (click)="deleteHecho(hecho.id)"
                                    class="p-1.5 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-all"
                                    title="Eliminar">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    } @empty {
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center text-slate-400">
                            No hay hechos registrados
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Form -->
    @if (showForm()) {
    <div
        class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm animate-in fade-in duration-300 overflow-y-auto">
        <div
            class="bg-white w-full max-w-xl rounded-3xl shadow-2xl border border-slate-100 my-8 animate-in zoom-in-95 duration-300">
            <div class="flex items-center justify-between p-4 border-b border-slate-100 bg-slate-50/50 rounded-t-3xl">
                <h3 class="text-lg font-bold text-slate-900">
                    {{ currentHecho.id ? 'Editar Hecho #' + currentHecho.id : 'Nuevo Hecho' }}
                </h3>
                <button (click)="closeForm()" class="p-2 text-slate-400 hover:text-slate-600 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <form (ngSubmit)="saveHecho()" class="p-5 space-y-4">
                <!-- Basic Info -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Categoría</label>
                        <select [(ngModel)]="currentHecho.category" name="category"
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 font-medium focus:ring-2 focus:ring-indigo-500/20 outline-none">
                            <option value="OPERATIVO">OPERATIVO</option>
                            <option value="POLICIAL">POLICIAL</option>
                            <option value="INFORMATIVO">INFORMATIVO</option>
                            <option value="RELEVAMIENTO">RELEVAMIENTO</option>
                        </select>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Fecha y Hora Inicio</label>
                        <input type="datetime-local" [(ngModel)]="currentHecho.timestamp" name="timestamp" required
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 font-medium outline-none">
                    </div>
                </div>

                <!-- Location & Context -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Sector / Área</label>
                        <input type="text" [(ngModel)]="currentHecho.sector" name="sector"
                            placeholder="Ej: Hall Central, Perímetro..."
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Cámara Vinculada</label>
                        <select [(ngModel)]="currentHecho.camera" name="camera"
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none">
                            <option [ngValue]="null">-- General / Sin Cámara --</option>
                            @for (cam of cameras(); track cam.id) {
                            <option [value]="cam.id">{{ cam.name }} ({{ cam.system_name }})</option>
                            }
                        </select>
                    </div>
                </div>

                <!-- Details -->
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Descripción / Novedad Sugerida</label>
                    <textarea [(ngModel)]="currentHecho.description" name="description" rows="3" required
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none resize-none"></textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Elementos Involucrados</label>
                        <input type="text" [(ngModel)]="currentHecho.elements" name="elements"
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Grupos Intervinientes</label>
                        <input type="text" [(ngModel)]="currentHecho.intervening_groups" name="intervening_groups"
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none">
                    </div>
                </div>

                <!-- Flags -->
                <div class="flex flex-wrap gap-4 p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" [(ngModel)]="currentHecho.is_solved" name="is_solved"
                            class="w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500">
                        <span class="text-xs font-semibold text-slate-700">¿Se Solucionó?</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" [(ngModel)]="currentHecho.coc_intervention" name="coc_intervention"
                            class="w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500">
                        <span class="text-xs font-semibold text-slate-700">Intervención COC</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" [(ngModel)]="currentHecho.generated_cause" name="generated_cause"
                            class="w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500">
                        <span class="text-xs font-semibold text-slate-700">Generó Causa</span>
                    </label>
                </div>

                <!-- Resolution -->
                @if (currentHecho.is_solved) {
                <div class="space-y-3 pt-2 border-t border-slate-100 animate-in fade-in slide-in-from-top-2">
                    <h4 class="font-bold text-slate-900 text-sm border-l-4 border-emerald-500 pl-3">Datos de Resolución
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 uppercase">Hora Finalización</label>
                            <input type="datetime-local" [(ngModel)]="currentHecho.end_time" name="end_time"
                                class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-500 uppercase">Tiempo Resolución</label>
                            <input type="text" [(ngModel)]="currentHecho.resolution_time" name="resolution_time"
                                placeholder="Ej: 2h 30m"
                                class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none">
                        </div>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-500 uppercase">Detalle de Resolución</label>
                        <textarea [(ngModel)]="currentHecho.resolution_details" name="resolution_details" rows="2"
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none resize-none"></textarea>
                    </div>
                </div>
                }

                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Referencia Externa / Ticket</label>
                    <input type="text" [(ngModel)]="currentHecho.external_ref" name="external_ref"
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 outline-none">
                </div>

                <div class="pt-4 flex gap-3 border-t border-slate-100">
                    <button type="button" (click)="closeForm()"
                        class="flex-1 bg-white hover:bg-slate-50 text-slate-600 font-bold py-2.5 rounded-xl border border-slate-200 transition-all text-xs">Cancelar</button>
                    <button type="submit"
                        class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 rounded-xl transition-all shadow-lg shadow-indigo-100 hover:shadow-xl hover:scale-[1.01] text-xs">
                        Guardar Registro
                    </button>
                </div>
            </form>
        </div>
    </div>
    }
</div>