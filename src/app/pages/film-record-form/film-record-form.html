<div class="max-w-5xl mx-auto py-8">
    <div class="mb-6 flex items-center justify-between">
        <h1 class="text-3xl font-bold text-gray-900">{{ isEditMode ? 'Editar Registro' : 'Nuevo Registro CREV' }}</h1>
        <a routerLink="/registros" class="text-indigo-600 hover:text-indigo-900 font-medium">‚Üê Volver al listado</a>
    </div>

    <form [formGroup]="recordForm" (ngSubmit)="onSubmit()" class="space-y-8 pb-20">

        <!-- Secci√≥n 1: Datos de Ingreso -->
        <div class="bg-white shadow-xl rounded-xl border border-gray-100 overflow-hidden">
            <div class="bg-indigo-600 px-6 py-3 text-white font-bold flex items-center gap-2">
                <span>üìÖ</span> 1. Datos de Ingreso
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-3 space-y-2">
                    <label class="text-sm font-semibold text-gray-700">T√≠tulo / Resumen del Registro *</label>
                    <input type="text" formControlName="nroAsunto" placeholder="Ej: Registro escena del crimen..."
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">N¬∫ de Orden</label>
                    <input type="text" formControlName="nroOrden"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Fecha Ingreso</label>
                    <input type="date" formControlName="fechaIngreso"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Estado</label>
                    <select formControlName="estado"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                        @for (st of statuses; track st.value) {
                        <option [value]="st.value">{{ st.label }}</option>
                        }
                    </select>
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Tipo Solicitud</label>
                    <select formControlName="idTipoSolicitud"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                        <option value="">Seleccione...</option>
                        @for (rt of requestTypes$ | async; track rt.id) {
                        <option [value]="rt.id">{{ rt.name }}</option>
                        }
                    </select>
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">N√∫mero Solicitud</label>
                    <input type="text" formControlName="nroSolicitud"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Solicitante</label>
                    <input type="text" formControlName="solicitante"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
            </div>
        </div>

        <!-- Secci√≥n 2: Datos Judiciales / Hecho -->
        <div class="bg-white shadow-xl rounded-xl border border-gray-100 overflow-hidden">
            <div class="bg-indigo-600 px-6 py-3 text-white font-bold flex items-center gap-2">
                <span>‚öñÔ∏è</span> 2. Datos Judiciales / Hecho
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Causa Judicial / Prevenci√≥n</label>
                    <input type="text" formControlName="causaJudicial"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Fecha del Hecho</label>
                    <input type="date" formControlName="fechaHecho"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="md:col-span-2 space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Car√°tula</label>
                    <input type="text" formControlName="caratula"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Tipo de Delito</label>
                    <select formControlName="idTipoDelito"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                        <option value="">Seleccione...</option>
                        @for (ct of crimeTypes$ | async; track ct.id) {
                        <option [value]="ct.id">{{ ct.name }}</option>
                        }
                    </select>
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Dependencia Interviniente</label>
                    <select formControlName="idUnidad"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                        <option value="">Seleccione...</option>
                        @for (u of units$ | async; track u.id) {
                        <option [value]="u.id">{{ u.name }}</option>
                        }
                    </select>
                </div>
            </div>
        </div>

        <!-- Secci√≥n 3: Detalle y Producci√≥n -->
        <div class="bg-white shadow-xl rounded-xl border border-gray-100 overflow-hidden">
            <div class="bg-indigo-600 px-6 py-3 text-white font-bold flex items-center gap-2">
                <span>üé¨</span> 3. Detalle y Producci√≥n
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">N¬∫ de DVD</label>
                    <input type="text" formControlName="nroDvd"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">N¬∫ de Informe</label>
                    <input type="text" formControlName="nroInforme"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Recepcionado Por</label>
                    <input type="text" formControlName="recepcionadoPor"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Confeccionado Por</label>
                    <input type="text" formControlName="confeccionadoPor"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="md:col-span-2 space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Detalle Adicional</label>
                    <textarea formControlName="detalle" rows="2"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none"></textarea>
                </div>
            </div>
        </div>

        <!-- Secci√≥n: Contexto Organizacional (Nueva) -->
        <div class="bg-white shadow-xl rounded-xl border border-gray-100 overflow-hidden">
            <div class="bg-indigo-800 px-6 py-3 text-white font-bold flex items-center gap-2">
                <span>üè¢</span> Contexto Organizacional (Control de Acceso)
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Unidad Organizacional</label>
                    <select formControlName="orgUnitId"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Seleccione Unidad...</option>
                        @for (u of orgUnits$ | async; track u.id) {
                        <option [value]="u.id">{{ u.name }}</option>
                        }
                    </select>
                    <p class="text-xs text-gray-500 italic">Determina qui√©n puede ver este registro en base a su grupo.
                    </p>
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">VMS Relacionado</label>
                    <select formControlName="orgSystemId"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Seleccione Sistema...</option>
                        @for (s of orgSystems$ | async; track s.id) {
                        <option [value]="s.id">{{ s.name }}</option>
                        }
                    </select>
                </div>
            </div>
        </div>

        <!-- Secci√≥n 4: Egreso / Finalizaci√≥n -->
        <div class="bg-white shadow-xl rounded-xl border border-gray-100 overflow-hidden">
            <div class="bg-indigo-600 px-6 py-3 text-white font-bold flex items-center gap-2">
                <span>üì¶</span> 4. Egreso / Finalizaci√≥n
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Fecha de Salida</label>
                    <input type="date" formControlName="fechaSalida"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">IFGRA</label>
                    <input type="text" formControlName="ifgra"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Expediente</label>
                    <input type="text" formControlName="nroExpediente"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Retirado Por</label>
                    <input type="text" formControlName="retiradoPor"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">Organismo</label>
                    <select formControlName="idOrganismo"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                        <option value="">Seleccione...</option>
                        @for (org of organizations$ | async; track org.id) {
                        <option [value]="org.id">{{ org.name }}</option>
                        }
                    </select>
                </div>
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-gray-700">N¬∫ Acta Entrega</label>
                    <input type="text" formControlName="actaEntrega"
                        class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none">
                </div>
            </div>
        </div>

        <!-- Observaciones -->
        <div class="bg-white shadow-xl rounded-xl border border-gray-100 overflow-hidden">
            <div class="bg-gray-600 px-6 py-3 text-white font-bold flex items-center gap-2">
                <span>üìù</span> Observaciones
            </div>
            <div class="p-6">
                <textarea formControlName="observaciones" rows="3" placeholder="Notas adicionales..."
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 outline-none"></textarea>
            </div>
        </div>

        <!-- Botones de Acci√≥n Global -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 shadow-2xl z-40 flex justify-center gap-4">
            <button type="button" routerLink="/registros"
                class="px-10 py-3 rounded-xl border-2 border-gray-300 text-gray-700 font-bold hover:bg-gray-50 transition-all">
                Cancelar
            </button>
            <button type="submit" [disabled]="recordForm.invalid"
                class="px-10 py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 disabled:bg-indigo-300 transition-all shadow-lg flex items-center gap-2">
                <span>üíæ</span> {{ isEditMode ? 'Actualizar Registro' : 'Guardar Registro CREV' }}
            </button>
        </div>

    </form>

    @if (isLoading) {
    <app-loader [fullScreen]="true" message="Procesando registro... Por favor espere."></app-loader>
    }
</div>